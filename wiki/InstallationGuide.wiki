#labels installation
==Requirements==

  * JDK 1.6
  * Glassfish 2.2 or Tomcat 5.5.x
  * Postgres 8.2+
  * Postgis 1.3+

I would recommend installing the JDK and Glassfish or Tomcat manually.
If you are running Ubuntu 8.04 then these versions of Postgres and Postgis are very easy to install. 
{{{
sudo apt-get install postgres postgis
}}}


==Installation==

*1. Make sure that the required software is installed properly*

*2. Checkout the source from google code and put it all under one directory.*

The netbeans projects are:

  *ErgoRR-client < client API through SOAP interface

  *ErgoRR-backend-client < client API connecting directly to backend

  *ErgoRR-commons < common classes

  *ErgoRR-jaxb < JAXB bindings

  *ErgoRR-persistence < persistence layer

  *ErgoRR-web-war < web application

  *There is another folder "ErgoRR-shared": these are just libraries.


*3. Create database and add spatial functionality*
  * In Postgres, create the database with the name "ergorr".
  * Change to the postgres user with the command: 
{{{
sudo su postgres
}}}
  * Enable plpqsql on the newly created database with the command:
{{{
createlang plpgsql ergorr
}}}
  * Run the postgis scripts on database "ergorr" to enable spatial functionality.
{{{
psql -d ergorr -f /usr/share/postgresql-8.3-postgis/lwpostgis.sql
psql -d ergorr -f /usr/share/postgresql-8.3-postgis/spatial_ref_sys.sql
}}}
  * Run the database script (ergo_source_dir)/ErgoRR-persistence/conf/database.sql

== Glassfish specific ==

*4. Copy libraries to Glassfish*
  * Make sure that you have the environment variable AS_HOME (which is the Glassfish installation directory).
  * Copy the following files to AS_HOME/lib
    * (ergo_source_dir)/ErgoRR-shared/postgis/postgis_1.3.3.jar
    * (ergo_source_dir)/ErgoRR-shared/postgreSQL/postgresql-8.3-603.jdbc3.jar


*5. Add Postgres connection datasource to Glassfish *
  * In the administration portal, from the left menu, click through _Resources_ > _JDBC_ > _Connection Pools_ and click _New_ to create a new pool with the following values.
    * Name: postgresPool
    * Resource Type: javax.sql.DataSource
    * Database Vendor: PostgreSQL
  * Click _Next_ to continue. In the following page scroll down and set your database properties (URL, user, password, ...). And click _Finish_.
  * Now that we have a connection pool, we need to create the data source.
  * From the left menu click through _Resources_ > _JDBC_ > _JDBC Resources_ and click _New_ to add a new resource with the following values:
    * JNDI Name: jdbc/ergorr
    * Pool Name: postgresPool (the one which you created)
  * And click _OK_ to finish.


*6. Add Glassfish to Netbeans* 
  * This can be done from the top menu _Tools_ > _Servers_.
  * Now you can set the project to run on your Glassfish installation.
    * Right click on the project _ErgoRR-enterprice_ to select _Properties_.
    * In the properties window select _Run_ from the left menu and select the server you have just configured in the _Server_ property field.

== Tomcat specific ==

*4. Install files to Tomcat*
  * Make sure that you have the variable CATALINA_HOME set.
  * From (ergo_source_dir)/ErgoRR-web-war directory run the command
{{{
ant tomcat-install
}}}

This will copy the following files:

(ergo_source_dir)/ErgoRR-shared/postgreSQL/postgresql-8.3-603.jdbc3.jar to CATALINA_HOME/common/lib

(ergo_source_dir)/ErgoRR-shared/metro1_2/webservices-api.jar to CATALINA_HOME/common/endorsed

(ergo_source_dir)/ErgoRR-web-war/conf/ErgoRR-web-war.xml to CATALINA_HOME/conf/Catalina/localhost

*5. Configure Database *

Edit the file CATALINA_HOME/conf/Catalina/localhost/ErgoRR-web-war.xml to match to your postgres setup.

Note: If you edit the name of the deployment file ErgoRR-web-war.war then you have to set the same name for the ErgoRR-web-war.xml.

*6. Deploy *

  * Build the ErgoRR-web-war project and copy the dist/ErgoRR-web-war.war to Tomcat webapp directory.